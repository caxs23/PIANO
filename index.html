<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Keyboard Piano</title>
<style>
body {
  background:#222;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:sans-serif;
}

#piano {
  position:relative;
  display:flex;
}

.white {
  width:40px;
  height:180px;
  background:white;
  border:1px solid #000;
  box-sizing:border-box;
  position:relative;
}

.white span {
  position:absolute;
  bottom:6px;
  left:50%;
  transform:translateX(-50%);
  font-size:12px;
  color:black;
}

.white.active {
  background:#ddd;
}

.black {
  width:26px;
  height:110px;
  background:black;
  position:absolute;
  top:0;
  z-index:2;
}

.black span {
  position:absolute;
  bottom:6px;
  left:50%;
  transform:translateX(-50%);
  font-size:11px;
  color:white;
}

.black.active {
  background:#444;
}
</style>
</head>
<body>

<div id="piano"></div>

<script>
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

// sustain pedal always ON
const SUSTAIN_TIME = 3.0;

// white keys
const whiteKeys = [
  "z","x","c","v","b","n","m",",",".","/",
  "q","w","e","r","t","y","u","i","o","p","[","]"
];

// white notes (C3 start)
const whiteNotes = [
  "C","D","E","F","G","A","B",
  "C","D","E","F","G","A","B",
  "C","D","E","F","G","A","B","C"
];

// black key keyboard order (LEFT â†’ RIGHT)
const blackKeyOrder = [
  "s","d","g","h","j",
  "l",";",
  "2","3","4",
  "6","7",
  "9","0","-"
];

// black note pattern per octave
const blackNotePattern = [
  "C#","D#","F#","G#","A#"
];

const piano = document.getElementById("piano");
const keyMap = {};
let octave = 3;
let blackIndex = 0;

// create keys
whiteKeys.forEach((key, i) => {
  const white = document.createElement("div");
  white.className = "white";
  white.innerHTML = `<span>${key}</span>`;
  piano.appendChild(white);

  const note = whiteNotes[i] + octave;
  keyMap[key] = { note, el:white };

  // black key positions (no black after E or B)
  if (![2,6,9,13,16,20].includes(i) && blackIndex < blackKeyOrder.length) {
    const black = document.createElement("div");
    black.className = "black";
    black.style.left = (i * 40 + 28) + "px";
    black.innerHTML = `<span>${blackKeyOrder[blackIndex]}</span>`;
    piano.appendChild(black);

    const blackNote =
      blackNotePattern[blackIndex % 5] + octave;

    keyMap[blackKeyOrder[blackIndex]] = {
      note:blackNote,
      el:black
    };

    blackIndex++;
  }

  if (whiteNotes[i] === "B") octave++;
});

function playNote(note, el) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = "sine";
  osc.frequency.value = noteToFreq(note);

  gain.gain.setValueAtTime(0.0001, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.45, audioCtx.currentTime + 0.01);
  gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + SUSTAIN_TIME);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + SUSTAIN_TIME);

  el.classList.add("active");
  setTimeout(() => el.classList.remove("active"), 150);
}

function noteToFreq(note) {
  const map = {
    "C":0,"C#":1,"D":2,"D#":3,"E":4,
    "F":5,"F#":6,"G":7,"G#":8,
    "A":9,"A#":10,"B":11
  };
  const oct = parseInt(note.slice(-1));
  const key = note.slice(0,-1);
  const n = map[key] + (oct - 4) * 12;
  return 440 * Math.pow(2, (n - 9) / 12);
}

// keyboard input
document.addEventListener("keydown", e => {
  if (keyMap[e.key]) {
    const {note, el} = keyMap[e.key];
    playNote(note, el);
  }
});
</script>

</body>
</html>
